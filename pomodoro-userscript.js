(function(){"use strict";const U=o=>(e,t)=>(o.set(e,t),t),O=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,k=536870912,R=k*2,q=(o,e)=>t=>{const n=e.get(t);let s=n===void 0?t.size:n<R?n+1:0;if(!t.has(s))return o(t,s);if(t.size<k){for(;t.has(s);)s=Math.floor(Math.random()*R);return o(t,s)}if(t.size>O)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;t.has(s);)s=Math.floor(Math.random()*O);return o(t,s)},S=new WeakMap,W=U(S),L=q(W,S),j=o=>typeof o.start=="function",C=new WeakMap,B=o=>({...o,connect:({call:e})=>async()=>{const{port1:t,port2:n}=new MessageChannel,s=await e("connect",{port:t},[t]);return C.set(n,s),n},disconnect:({call:e})=>async t=>{const n=C.get(t);if(n===void 0)throw new Error("The given port is not connected.");await e("disconnect",{portId:n})},isSupported:({call:e})=>()=>e("isSupported")}),_=new WeakMap,V=o=>{if(_.has(o))return _.get(o);const e=new Map;return _.set(o,e),e},G=o=>{const e=B(o);return t=>{const n=V(t);t.addEventListener("message",(({data:d})=>{const{id:u}=d;if(u!==null&&n.has(u)){const{reject:f,resolve:c}=n.get(u);n.delete(u),d.error===void 0?c(d.result):f(new Error(d.error.message))}})),j(t)&&t.start();const s=(d,u=null,f=[])=>new Promise((c,h)=>{const a=L(n);n.set(a,{reject:h,resolve:c}),u===null?t.postMessage({id:a,method:d},f):t.postMessage({id:a,method:d,params:u},f)}),i=(d,u,f=[])=>{t.postMessage({id:null,method:d,params:u},f)};let l={};for(const[d,u]of Object.entries(e))l={...l,[d]:u({call:s,notify:i})};return{...l}}},E=new Map([[0,null]]),M=new Map([[0,null]]),z=G({clearInterval:({call:o})=>e=>{typeof E.get(e)=="symbol"&&(E.set(e,null),o("clear",{timerId:e,timerType:"interval"}).then(()=>{E.delete(e)}))},clearTimeout:({call:o})=>e=>{typeof M.get(e)=="symbol"&&(M.set(e,null),o("clear",{timerId:e,timerType:"timeout"}).then(()=>{M.delete(e)}))},setInterval:({call:o})=>(e,t=0,...n)=>{const s=Symbol(),i=L(E);E.set(i,s);const l=()=>o("set",{delay:t,now:performance.timeOrigin+performance.now(),timerId:i,timerType:"interval"}).then(()=>{const d=E.get(i);if(d===void 0)throw new Error("The timer is in an undefined state.");d===s&&(e(...n),E.get(i)===s&&l())});return l(),i},setTimeout:({call:o})=>(e,t=0,...n)=>{const s=Symbol(),i=L(M);return M.set(i,s),o("set",{delay:t,now:performance.timeOrigin+performance.now(),timerId:i,timerType:"timeout"}).then(()=>{const l=M.get(i);if(l===void 0)throw new Error("The timer is in an undefined state.");l===s&&(M.delete(i),e(...n))}),i}}),D=((o,e)=>{let t=null;return()=>{if(t!==null)return t;const n=new Blob([e],{type:"application/javascript; charset=utf-8"}),s=URL.createObjectURL(n);return t=o(s),setTimeout(()=>URL.revokeObjectURL(s)),t}})(o=>{const e=new Worker(o);return z(e)},`(()=>{var e={455:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,s=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<s?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*s);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,u=r(i),c=a(u,i),l=t(c);e.addUniqueNumber=l,e.generateUniqueNumber=c}(t)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(()=>{"use strict";const e=-32603,t=-32602,n=-32601,o=(e,t)=>Object.assign(new Error(e),{status:t}),s=t=>o('The handler of the method called "'.concat(t,'" returned an unexpected result.'),e),a=(t,r)=>async({data:{id:a,method:i,params:u}})=>{const c=r[i];try{if(void 0===c)throw(e=>o('The requested method called "'.concat(e,'" is not supported.'),n))(i);const r=void 0===u?c():c(u);if(void 0===r)throw(t=>o('The handler of the method called "'.concat(t,'" returned no required result.'),e))(i);const l=r instanceof Promise?await r:r;if(null===a){if(void 0!==l.result)throw s(i)}else{if(void 0===l.result)throw s(i);const{result:e,transferables:r=[]}=l;t.postMessage({id:a,result:e},r)}}catch(e){const{message:r,status:n=-32603}=e;t.postMessage({error:{code:n,message:r},id:a})}};var i=r(455);const u=new Map,c=(e,r,n)=>({...r,connect:({port:t})=>{t.start();const n=e(t,r),o=(0,i.generateUniqueNumber)(u);return u.set(o,()=>{n(),t.close(),u.delete(o)}),{result:o}},disconnect:({portId:e})=>{const r=u.get(e);if(void 0===r)throw(e=>o('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),t))(e);return r(),{result:null}},isSupported:async()=>{if(await new Promise(e=>{const t=new ArrayBuffer(0),{port1:r,port2:n}=new MessageChannel;r.onmessage=({data:t})=>e(null!==t),n.postMessage(t,[t])})){const e=n();return{result:e instanceof Promise?await e:e}}return{result:!1}}}),l=(e,t,r=()=>!0)=>{const n=c(l,t,r),o=a(e,n);return e.addEventListener("message",o),()=>e.removeEventListener("message",o)},d=(e,t)=>r=>{const n=t.get(r);if(void 0===n)return Promise.resolve(!1);const[o,s]=n;return e(o),t.delete(r),s(!1),Promise.resolve(!0)},f=(e,t,r,n)=>(o,s,a)=>{const i=o+s-t.timeOrigin,u=i-t.now();return new Promise(t=>{e.set(a,[r(n,u,i,e,t,a),t])})},m=new Map,h=d(globalThis.clearTimeout,m),p=new Map,v=d(globalThis.clearTimeout,p),w=((e,t)=>{const r=(n,o,s,a)=>{const i=n-e.now();i>0?o.set(a,[t(r,i,n,o,s,a),s]):(o.delete(a),s(!0))};return r})(performance,globalThis.setTimeout),g=f(m,performance,globalThis.setTimeout,w),T=f(p,performance,globalThis.setTimeout,w);l(self,{clear:async({timerId:e,timerType:t})=>({result:await("interval"===t?h(e):v(e))}),set:async({delay:e,now:t,timerId:r,timerType:n})=>({result:await("interval"===n?g:T)(e,t,r)})})})()})();`),K=o=>D().clearInterval(o),X=(...o)=>D().setInterval(...o);class H{#e={};on(e,t){const n=this.listeners(e);return n.push(t),this.#e[e]=n,this}once(e,t){const n=new Proxy(t,{apply:(s,i,l)=>{s(...l),this.off(e,n)}});return this.on(e,n),n}emit(e,...t){const n=this.listeners(e);for(let s=0;s<n.length;s++)n[s](...t);return!!n.length}off(e,t){return this.#e[e]&&(this.#e[e]=this.#e[e].filter(n=>n!==t)),this}removeAllListeners(e){return e?delete this.#e[e]:this.#e={},this}eventNames(){return Reflect.ownKeys(this.#e)}listeners(e){return this.#e[e]??[]}listenerCount(e){return this.#e[e]?.length??0}}const w=new H;class Y{interval;minutes;seconds;setTime({minutes:e,seconds:t}){this.minutes=e,this.seconds=t}start(){this.stop(),this.interval=X(()=>this.tick(),1e3)}stop(){this.interval&&(K(this.interval),this.interval=null)}tick(){this.seconds--,this.minutes>0&&this.seconds<0&&(this.seconds=59,this.minutes--),this.minutes===0&&this.seconds===0&&w.emit("timer_stop"),w.emit("timer_tick",{minutes:this.minutes,seconds:this.seconds})}}class ${#e;#t;#s;#o;#n;constructor(e,t,n,s){this.#e=e,this.#t=t,this.#n=n,this.#s=i=>s?.encode?s.encode(i):JSON.stringify(i),this.#o=i=>s?.decode?s.decode(i):JSON.parse(i),this.has()||this.write(this.#t)}get initialValue(){return this.#t}get value(){try{const e=this.#n.getItem(this.#e);return e?this.#o(e):this.#t}catch(e){return console.error(e),this.#t}}write(e){e instanceof Function&&(e=e(this.value));try{this.#n.setItem(this.#e,this.#s(e))}catch(t){return console.error(t),this.#t}return e}has(){return this.#n.getItem(this.#e)!==null}reset(){this.write(this.#t)}}class J extends ${constructor(e,t,n){super(e,t,localStorage,n)}}const A="pomodoro-storage";class Q{initialData={time:{minutes:0,seconds:0},onTickTime:{minutes:0,seconds:0},isRunning:!1,position:{x:0,y:0}};storage=new J(A,this.initialData);get data(){return this.storage.value}getByKey(e){return this.data[e]}write(e){this.storage.write(e)}reset(){this.storage.reset()}}const y=new Q;function T(o,e,...t){const n=document.createElement(o);return e instanceof Node?n.append(e):typeof e=="string"?n.append(Z(e)):Array.isArray(e)?n.append(...e):(Object.assign(n,e),Object.assign(n.style,e?.style)),n.append(...t),n}function Z(o){return document.createTextNode(o)}function ee(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var x={exports:{}};var te=x.exports,P;function ne(){return P||(P=1,(function(o,e){(function(t,n){o.exports=n()})(te,function(){return(function(t){function n(i){if(s[i])return s[i].exports;var l=s[i]={exports:{},id:i,loaded:!1};return t[i].call(l.exports,l,l.exports,n),l.loaded=!0,l.exports}var s={};return n.m=t,n.c=s,n.p="",n(0)})([function(t,n,s){function i(u){return u&&u.__esModule?u:{default:u}}var l=s(1),d=i(l);t.exports=d.default},function(t,n,s){function i(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}function l(){var a=this,r=this.el,p=this.opts||c,g={};if(r.style.position="absolute",this.handle=p.handle||r,p.constrain){for(var v=p.relativeTo||r.parentNode,m=r,b=0,I=0;m!==v;)m=m.parentNode,(0,d.isRelative)(m)&&(b-=m.offsetLeft,I-=m.offsetTop),m===v&&(b+=m.offsetLeft,I+=m.offsetTop);var de=b+v.offsetWidth-r.offsetWidth,pe=I+v.offsetHeight-r.offsetHeight;g.xClamp=(0,d.generateClamp)(b,de),g.yClamp=(0,d.generateClamp)(I,pe)}this.opts=p,this.data=g,this.events={mousedown:u.mousedown.bind(this),mouseup:u.mouseup.bind(this),touchstart:u.touchstart.bind(this),touchstop:u.touchstop.bind(this),scrollFix:function(me){a.isDragging&&me.preventDefault()}},this.handleMove=f(this.opts.customMove),this.handle.addEventListener("mousedown",this.events.mousedown,!1),this.handle.addEventListener("touchstart",this.events.touchstart,!1),document.addEventListener("touchmove",this.events.scrollFix,{passive:!1})}Object.defineProperty(n,"__esModule",{value:!0});var d=s(2),u=s(3),f=(0,d.generateMoveFn)(),c={constrain:!1,relativeTo:null,handle:null,ignoreFn:null,highlightInputs:!1,onMouseDown:null,onMouseMove:null,onMouseUp:null,onTouchStart:null,onTouchMove:null,onTouchStop:null,customMove:null},h=(function(){function a(r,p){if(i(this,a),!r)throw Error("Must include moveable element");this.el=r,this.opts=p,l.call(this)}return a.prototype.reinit=function(){this.destroy(),l.call(this)},a.prototype.destroy=function(){var r=this.events;this.handle.removeEventListener("mousedown",r.mousedown,!1),document.removeEventListener("mousemove",r.mousemove,!1),document.removeEventListener("mouseup",r.mouseup,!1),this.handle.removeEventListener("touchstart",r.touchstart,!1),document.removeEventListener("touchmove",r.touchmove,!1),document.removeEventListener("touchstop",r.touchstop,!1),document.removeEventListener("touchmove",this.events.scrollFix,{passive:!1})},a})();n.default=function(a,r){return new h(a,r)}},function(t,n){function s(u,f){return function(c){return Math.min(Math.max(c,u),f)}}function i(u){return window.getComputedStyle(u).position==="relative"}function l(){return window.requestAnimationFrame?function(u){var f=u||d;return function(c,h,a){window.requestAnimationFrame(function(){f(c,h,a)})}}:function(u){return function(f,c,h){var a=u||d;a(f,c,h)}}}function d(u,f,c){u.style.left=f+"px",u.style.top=c+"px"}Object.defineProperty(n,"__esModule",{value:!0}),n.generateClamp=s,n.isRelative=i,n.generateMoveFn=l},function(t,n){function s(c){var h=this.opts;if(h.highlightInputs){var a=c.target.tagName.toLowerCase();if(a==="input"||a==="textarea")return}if(!h.ignoreFn||!h.ignoreFn(c)){if(c.button===0){var r=this.el,p=this.events;typeof h.onMouseDown=="function"&&h.onMouseDown(r,c);var g=c.clientX-r.offsetLeft,v=c.clientY-r.offsetTop;p.mousemove=i.bind(this,g,v),document.addEventListener("mousemove",p.mousemove,!1),document.addEventListener("mouseup",p.mouseup,!1)}c.preventDefault()}}function i(c,h,a){var r=this.el,p=this.opts,g=this.data;typeof p.onMouseMove=="function"&&p.onMouseMove(r,a);var v=a.clientX-c,m=a.clientY-h;return p.constrain&&(v=g.xClamp(v),m=g.yClamp(m)),this.handleMove(r,v,m),a.preventDefault(),!1}function l(c){var h=this.el,a=this.opts,r=this.events;typeof a.onMouseUp=="function"&&a.onMouseUp(h,c),document.removeEventListener("mouseup",r.mouseup,!1),document.removeEventListener("mousemove",r.mousemove,!1)}function d(c){var h=this.opts;if(h.highlightInputs){var a=c.target.tagName.toLowerCase();if(a==="input"||a==="textarea")return}if(!h.ignoreFn||!h.ignoreFn(c)){var r=this.el,p=this.events;typeof h.onTouchStart=="function"&&h.onTouchStart(r,c);var g=c.targetTouches[0],v=g.clientX-r.offsetLeft,m=g.clientY-r.offsetTop;p.touchmove=u.bind(this,v,m),this.isDragging=!0,document.addEventListener("touchmove",p.touchmove,!1),document.addEventListener("touchend",p.touchstop,!1),document.addEventListener("touchcancel",p.touchstop,!1)}}function u(c,h,a){var r=this.el,p=this.opts,g=this.data;typeof p.onTouchMove=="function"&&p.onTouchMove(r,a);var v=a.targetTouches[0],m=v.clientX-c,b=v.clientY-h;return p.constrain&&(m=g.xClamp(m),b=g.yClamp(b)),this.handleMove(r,m,b),a.preventDefault(),!1}function f(c){this.isDragging=!1;var h=this.el,a=this.opts,r=this.events;typeof a.onTouchStop=="function"&&a.onTouchStop(h,c),document.removeEventListener("touchmove",r.touchmove,!1),document.removeEventListener("touchend",r.touchstop,!1),document.removeEventListener("touchcancel",r.touchstop,!1)}Object.defineProperty(n,"__esModule",{value:!0}),n.mousedown=s,n.mousemove=i,n.mouseup=l,n.touchstart=d,n.touchmove=u,n.touchstop=f}])})})(x)),x.exports}var se=ne();const oe=ee(se);class re{target;displace;options;constructor(...e){this.target=this.options?.handle??e[0],this.options=e[1],this.displace=oe(...e),this.destroy(),this.reinit=this.reinit.bind(this);const t=()=>{this.displace.reinit(),this.target.removeEventListener("mouseenter",t)};this.target.addEventListener("mouseenter",t),window.addEventListener("resize",this.reinit)}reinit(){this.displace.reinit()}destroy(){this.displace.destroy(),window.removeEventListener("resize",this.reinit)}changePosition(e,t){this.target.style.left=`${e}px`,this.target.style.top=`${t}px`}}const ie=`.overlay {
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  cursor: grab;

  &.moved {
    position: fixed;
  }

  &.grabbing {
    cursor: grabbing;
  }

  .widget {
    z-index: 999999;
    position: fixed;
    background-color: #1f1f23;
    width: 70px;
    height: 32px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5), 0 0 4px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .widget-container {
    font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande',
      'Lucida Sans', Arial, sans-serif;
    font-size: 24px;
    color: #fff;
  }
}

.timer {
  display: flex;
  flex-direction: row;

  div {
    display: block;
    text-align: center;
    caret-color: transparent;

    &:focus {
      outline: none;
      color: tomato;
    }
  }
}
`;class F extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${ie}</style>`}}customElements.define("pomodoro-widget",F);class ae{el;interact;mount(e){this.el=T("div",{className:"overlay"},e);const t=new F;t.shadowRoot.appendChild(this.el),this.interact=new re(e,{constrain:!0,relativeTo:this.el,handle:e,onMouseDown:()=>{this.el.classList.add("grabbing")},onMouseUp:()=>{this.el.classList.remove("grabbing")},onMouseMove:n=>{const{x:s,y:i}=n.getBoundingClientRect();y.write(l=>({...l,position:{x:s,y:i}}))}}),this.updatePosition(),document.body.appendChild(t)}updatePosition(){const{x:e,y:t}=y.getByKey("position");this.interact.changePosition(e,t)}}function N(o){return o=Math.abs(o),o>9?`${o}`:`0${o}`}const ue=["minutes","seconds"];class ce{el;seconds;minutes;inputClock=0;currentInput;get inputData(){return{type:this.currentInput.dataset.type,time:this.currentInput.textContent}}mount(){for(const e of ue){const t=T("div",{contentEditable:"true"});t.dataset.type=e,t.addEventListener("keydown",n=>this.onKeyDown(n)),t.addEventListener("click",n=>{n.preventDefault(),this.focusInput(t)}),this[e]=t}this.updateInputValues(),this.el=T("div",{className:"timer"},this.minutes,":",this.seconds)}focusInput(e){this.currentInput=e,this.currentInput.focus(),this.updateInputClock(0)}onKeyDown(e){switch(e.preventDefault(),e.key){case"Enter":case"Escape":w.emit("timer_start",y.getByKey("time")),this.currentInput.blur();break;case"ArrowLeft":case"ArrowRight":this.navigateInput();break;case"ArrowUp":case"ArrowDown":this.incrementInputValue(e.key==="ArrowUp"?1:-1);break;default:if(Number.isNaN(Number.parseInt(e.key)))return;this.changeInputValue(e.key)}}navigateInput(){const e=this.currentInput.nextElementSibling??this.currentInput.previousElementSibling;this.focusInput(e)}changeInputValue(e){const{type:t,time:n}=this.inputData,s=this.inputClock?n.slice(1)+e:n.slice(0,1)+e,i=this.parseTime(t,s);this.writeInputValues(t,i),this.updateInputClock()}incrementInputValue(e){const{type:t,time:n}=this.inputData,s=this.parseTime(t,n,e);this.writeInputValues(t,s)}writeInputValues(e,t){this[e].textContent=N(t),y.write(n=>({...n,time:{...n.time,[e]:t}}))}updateInputClock(e){this.inputClock=e??(this.inputClock+1)%2}parseTime(e,t,n=0){let s=Number.parseInt(t)+n;switch(e){case"minutes":s<0&&(s=99),s>99&&(s=0);break;case"seconds":s<0&&(s=59),s>59&&(s=0);break}return s}updateInputValues(e){const t=y.getByKey("time");this.minutes.textContent=N(e?e.minutes:t.minutes),this.seconds.textContent=N(e?e.seconds:t.seconds),e&&y.write(n=>({...n,onTickTime:e}))}}class le{el;container;draggable;timer;mount(e,t){this.timer=t,this.draggable=e,this.container=T("div",{className:"widget-container"},this.timer.el),this.el=T("div",{className:"widget",onmouseenter:()=>{this.draggable.el.classList.add("moved")},onmouseleave:()=>{this.draggable.el.classList.remove("moved")},onauxclick:n=>{n.preventDefault()},oncontextmenu:n=>{n.preventDefault()}},this.container)}}class he{timer;draggable;widget;countdown;constructor(){this.timer=new ce,this.draggable=new ae,this.widget=new le,this.countdown=new Y}mount(){this.timer.mount(),this.widget.mount(this.draggable,this.timer),this.draggable.mount(this.widget.el),w.on("timer_start",e=>{this.countdown.setTime(e),this.countdown.start(),y.write(t=>({...t,isRunning:!0}))}),w.on("timer_stop",()=>{this.countdown.stop(),y.write(e=>({...e,isRunning:!0}))}),w.on("timer_tick",e=>{this.timer.updateInputValues(e)}),window.addEventListener("storage",e=>{const t=JSON.parse(e.oldValue),n=JSON.parse(e.newValue);!t.isRunning&&n.isRunning&&w.emit("timer_start",n.time),t.isRunning&&!n.isRunning&&w.emit("timer_stop"),e.key===A&&(this.draggable.updatePosition(),this.timer.updateInputValues())})}}new he().mount()})();
